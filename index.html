<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>You Are Not Alone â€“ Film</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles/main.css" />
</head>
<body>
  <!-- VIDEO GATE -->
  <section id="video-gate">
    <video
      id="film"
      autoplay
      muted
      playsinline
      poster="assets/images/poster-frame.jpg"
    >
      <source src="https://github.com/m-crow-m/notalone/releases/download/v1.0/you-are-not-alone.mp4" type="video/mp4" />
      Your browser does not support video playback.
    </video>

    <!-- Large play button overlay for first-time users -->
    <button type="button" id="play-overlay" class="play-overlay" aria-label="Play video">
      <span class="play-overlay-icon">â–¶</span>
    </button>

    <!-- Video overlay controls -->
    <div class="video-overlay">
      <div class="video-controls">
        <button type="button" id="play-toggle" class="control-button" aria-label="Play/Pause">
          <span class="control-icon">â–¶</span>
        </button>
        <button type="button" id="mute-toggle" class="control-button" aria-label="Mute/Unmute">
          <span class="control-icon">ğŸ”Š</span>
        </button>
        <div class="progress" aria-hidden="true">
          <span id="progress-fill"></span>
        </div>
        <button type="button" id="skip-link" class="skip-button" aria-label="Skip to site">
          SKIP
        </button>
      </div>

      <p class="gate-note">
        Best experienced with headphones
      </p>
    </div>
  </section>

  <!-- REST OF SITE (HIDDEN UNTIL VIDEO ENDS) -->
  <div id="site-content" class="hidden">
    <div class="page">
      <header>
        <h1>You Are Not Alone</h1>
        <div class="meta">
          2025 Â· Short film Â· AI and design
        </div>
      </header>

      <section class="section" id="context">
        <h2>Project context</h2>
        <p>
          [Your text here about the assignment and what this piece is.]
        </p>
      </section>

      <section class="section" id="statement">
        <h2>Artist statement</h2>
        <p>
          [Your artist statement lives here.]
        </p>
      </section>

      <section class="section" id="process">
        <h2>Process and AI</h2>
        <p>
          [Notes on Pika, Suno, Premiere, what you rejected, etc.]
        </p>
      </section>

      <section class="section" id="research">
        <h2>Research context</h2>
        <p>
          [Short paragraph about your research question and AI and emotion.]
        </p>
      </section>

      <section class="section" id="credits">
        <h2>Credits</h2>
        <p class="credits">
          Concept, direction, edit: Jaeden Crow<br />
          Course: AI and Design, Eastern Washington University<br />
          Instructor: Travis Masingale<br />
          Tools: Pika, Suno, Premiere Pro, Adobe suite
        </p>
      </section>

      <div style="margin-top: 60px; padding-top: 30px; border-top: 1px solid rgba(255, 255, 255, 0.15);">
        <button type="button" id="replay-btn" class="replay-button">
          REPLAY VIDEO
        </button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const video = document.getElementById("film");
      const gate = document.getElementById("video-gate");
      const videoOverlay = document.querySelector(".video-overlay");
      const siteContent = document.getElementById("site-content");
      const skipLink = document.getElementById("skip-link");
      const playToggle = document.getElementById("play-toggle");
      const muteToggle = document.getElementById("mute-toggle");
      const progressFill = document.getElementById("progress-fill");
      const playOverlay = document.getElementById("play-overlay");
      
      let gateClosed = false;
      let controlsHideTimer = null;

      function hidePlayOverlay() {
        if (playOverlay) {
          playOverlay.classList.add("hidden");
        }
      }

      function showControls() {
        if (videoOverlay) {
          videoOverlay.classList.remove("hidden-controls");
        }
        clearTimeout(controlsHideTimer);
        
        if (video && !video.paused) {
          controlsHideTimer = setTimeout(() => {
            if (videoOverlay && !video.paused) {
              videoOverlay.classList.add("hidden-controls");
            }
          }, 3000);
        }
      }

      function openSite() {
        if (gateClosed) return;
        gateClosed = true;

        if (video) {
          video.pause();
          gate.classList.add("hidden");
        }

        if (siteContent) {
          siteContent.classList.remove("hidden");
        }

        localStorage.setItem("videoWatched", "true");
        window.scrollTo({ top: 0, behavior: "instant" });
      }

      // Check if viewer has already watched - only set up event listeners if they haven't
      const alreadyWatched = localStorage.getItem("videoWatched") === "true";
      
      if (alreadyWatched) {
        // If they've watched before, show the site instead
        gate.classList.add("hidden");
        siteContent.classList.remove("hidden");
        gateClosed = true;
      } else {
        // First time viewer - show the video gate
        if (video) {
          // Try to autoplay
          const playPromise = video.play();
          if (playPromise !== undefined) {
            playPromise
              .then(() => {
                // Video started playing, hide the overlay button
                hidePlayOverlay();
              })
              .catch(err => {
                // Autoplay failed, keep the play button visible
                console.log("Autoplay failed, play button visible for user interaction");
              });
          }

          // Hide overlay when video starts playing
          video.addEventListener("play", () => {
            hidePlayOverlay();
            if (playToggle) playToggle.innerHTML = '<span class="control-icon">â¸</span>';
            showControls();
          });

          video.addEventListener("ended", openSite);
          
          video.addEventListener("timeupdate", () => {
            if (!progressFill || !video.duration) return;
            const percent = (video.currentTime / video.duration) * 100;
            progressFill.style.width = `${percent}%`;
          });

          video.addEventListener("pause", () => {
            if (playToggle) playToggle.innerHTML = '<span class="control-icon">â–¶</span>';
            if (videoOverlay) {
              videoOverlay.classList.remove("hidden-controls");
              clearTimeout(controlsHideTimer);
            }
          });

          video.addEventListener("volumechange", () => {
            if (!muteToggle) return;
            muteToggle.innerHTML = video.muted ? '<span class="control-icon">ğŸ”‡</span>' : '<span class="control-icon">ğŸ”Š</span>';
          });

          // Show controls on mouse move
          if (videoOverlay) {
            videoOverlay.addEventListener("mouseenter", showControls);
            gate.addEventListener("mousemove", showControls);
          }
        }
      }

      // Play overlay button
      if (playOverlay && video) {
        playOverlay.addEventListener("click", () => {
          video.play();
        });
      }

      if (skipLink) {
        skipLink.addEventListener("click", function (e) {
          e.preventDefault();
          if (video) {
            video.currentTime = video.duration || video.currentTime;
          }
          openSite();
        });
      }

      if (playToggle && video) {
        playToggle.addEventListener("click", () => {
          if (video.paused) {
            video.play();
          } else {
            video.pause();
          }
        });
      }

      if (muteToggle && video) {
        muteToggle.addEventListener("click", () => {
          video.muted = !video.muted;
          muteToggle.innerHTML = video.muted ? '<span class="control-icon">ğŸ”‡</span>' : '<span class="control-icon">ğŸ”Š</span>';
        });
      }

      // Replay button functionality
      const replayBtn = document.getElementById("replay-btn");
      if (replayBtn) {
        replayBtn.addEventListener("click", () => {
          gateClosed = false;
          siteContent.classList.add("hidden");
          gate.classList.remove("hidden");
          video.currentTime = 0;
          video.play();
          window.scrollTo({ top: 0, behavior: "smooth" });
        });
      }
    });
  </script>
</body>
</html>
