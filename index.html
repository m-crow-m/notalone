<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>You Are Not Alone – Film</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <link rel="stylesheet" href="styles/main.css?v=2025" />
</head>
<body>
  <!-- Background video (fixed) -->
  <video id="film" class="bg-video" autoplay muted playsinline preload="auto" poster="assets/images/poster-frame.jpg">
    <source src="https://github.com/m-crow-m/notalone/releases/download/v1.0/you-are-not-alone.mp4" type="video/mp4" />
    Your browser does not support video playback.
  </video>

  <!-- Noise layer (toggleable) -->
  <div id="noise-overlay" class="noise-overlay" aria-hidden="true"></div>

  <!-- Foreground content that scrolls over the video -->
  <main class="foreground">
    <div class="page">
      <header>
        <h1>You Are Not Alone</h1>
        <div class="meta">2025 · Short film · AI and design</div>
      </header>

      <section class="hero-text">
        <p>
          A short experimental film exploring companionship, technology, and the edges of perception. Scroll to reveal more.
        </p>
      </section>

      <section class="section" id="context">
        <h2>Project context</h2>
        <p>[Your text here about the assignment and what this piece is.]</p>
      </section>

      <section class="section" id="statement">
        <h2>Artist statement</h2>
        <p>[Your artist statement lives here.]</p>
      </section>

      <section class="section" id="process">
        <h2>Process and AI</h2>
        <p>[Notes on Pika, Suno, Premiere, what you rejected, etc.]</p>
      </section>

      <section class="section" id="research">
        <h2>Research context</h2>
        <p>[Short paragraph about your research question and AI and emotion.]</p>
      </section>

      <section class="section" id="credits">
        <h2>Credits</h2>
        <p class="credits">
          Concept, direction, edit: Jaeden Crow<br />
          Course: AI and Design, Eastern Washington University<br />
          Instructor: Travis Masingale<br />
          Tools: Pika, Suno, Premiere Pro, Adobe suite
        </p>
      </section>

      <div style="margin-top: 60px; padding-top: 30px; border-top: 1px solid rgba(255, 255, 255, 0.15);">
        <button type="button" id="replay-btn" class="replay-button">REPLAY VIDEO</button>
      </div>
    </div>
  </main>

  <!-- Sticky controls on the landing page -->
  <button id="noise-toggle" class="sticky-noise" aria-pressed="false" aria-label="Toggle noise overlay">
    <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M3 12h18M3 6h18M3 18h18"/></svg>
  </button>

  <button id="open-player" class="open-player" aria-label="Open player">Open Player</button>

  <!-- Fullscreen player controls (appear when player is active/fullscreen) -->
  <div id="player-controls" class="player-controls" hidden>
    <div class="player-row">
      <button id="player-play" class="control-button">Play</button>
      <button id="player-noise" class="control-button">Noise</button>
      <button id="player-close" class="control-button">×</button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const video = document.getElementById('film');
      const noise = document.getElementById('noise-overlay');
      const noiseToggle = document.getElementById('noise-toggle');
      const openPlayer = document.getElementById('open-player');
      const playerControls = document.getElementById('player-controls');
      const playerPlay = document.getElementById('player-play');
      const playerNoise = document.getElementById('player-noise');
      const playerClose = document.getElementById('player-close');
      const replayBtn = document.getElementById('replay-btn');

      // Load noise preference
      const savedNoise = localStorage.getItem('noiseVisible') === 'true';
      if (savedNoise) {
        noise.classList.add('visible');
        noiseToggle.setAttribute('aria-pressed', 'true');
      }

      // Start playback muted to satisfy autoplay policies across browsers
      if (video) {
        video.play().catch(()=>{});
      }

      // Noise toggle (landing page sticky)
      function toggleNoise(state) {
        const on = typeof state === 'boolean' ? state : !noise.classList.contains('visible');
        noise.classList.toggle('visible', on);
        noiseToggle.setAttribute('aria-pressed', String(on));
        noise.setAttribute('aria-hidden', String(!on));
        localStorage.setItem('noiseVisible', String(on));
      }

      noiseToggle.addEventListener('click', () => toggleNoise());

      // Open fullscreen player and show controls
      openPlayer.addEventListener('click', async () => {
        if (!video) return;
        // This is a user gesture — attempt to unmute and resume playback with sound
        try {
          video.muted = false;
          await video.play();
        } catch (err) {
          // If unmuting or play fails, continue anyway
        }
        try {
          await video.requestFullscreen();
        } catch (err) {
          // ignore fullscreen errors
        }
        playerControls.hidden = false;
        openPlayer.setAttribute('aria-expanded', 'true');
        playerPlay.textContent = video.paused ? 'Play' : 'Pause';
        playerPlay.focus();
      });

      // Play/pause in fullscreen controls
      playerPlay.addEventListener('click', () => {
        if (!video) return;
        if (video.paused) video.play(); else video.pause();
        playerPlay.textContent = video.paused ? 'Play' : 'Pause';
      });

      // Allow spacebar to toggle play when controls focused
      playerPlay.addEventListener('keydown', (e) => {
        if (e.code === 'Space') {
          e.preventDefault();
          playerPlay.click();
        }
      });

      // Player noise toggle mirrors the landing noise button
      playerNoise.addEventListener('click', () => {
        toggleNoise();
        playerNoise.focus();
      });

      // Close player: exit fullscreen and hide controls
      playerClose.addEventListener('click', async () => {
        if (document.fullscreenElement) await document.exitFullscreen();
        playerControls.hidden = true;
        openPlayer.setAttribute('aria-expanded', 'false');
        openPlayer.focus();
      });

      // Update play button text on play/pause
      video.addEventListener('play', () => { if (playerControls) playerPlay.textContent = 'Pause'; });
      video.addEventListener('pause', () => { if (playerControls) playerPlay.textContent = 'Play'; });

      // Replay button restarts video and scrolls to top
      if (replayBtn) {
        replayBtn.addEventListener('click', () => {
          video.currentTime = 0;
          video.play();
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
      }

      // Hide controls when leaving fullscreen
      document.addEventListener('fullscreenchange', () => {
        if (!document.fullscreenElement) {
          playerControls.hidden = true;
          openPlayer.setAttribute('aria-expanded', 'false');
        }
      });

      // Escape key handling: if fullscreen, exit and hide controls; otherwise do nothing
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' || e.key === 'Esc') {
          if (document.fullscreenElement) {
            document.exitFullscreen();
            playerControls.hidden = true;
            openPlayer.setAttribute('aria-expanded', 'false');
            openPlayer.focus();
          }
        }
      });
    });
  </script>
</body>
</html>
