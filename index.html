<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>You Are Not Alone â€“ Film</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles/main.css" />
</head>
<body>
  <!-- VIDEO GATE -->
  <section id="video-gate">
    <video
      id="film"
      autoplay
      muted
      playsinline
      poster="assets/images/poster-frame.jpg"
    >
      <source src="https://github.com/m-crow-m/notalone/releases/download/v1.0/you-are-not-alone.mp4" type="video/mp4" />
      Your browser does not support video playback.
    </video>

    <!-- Large play button overlay for first-time users -->
    <button type="button" id="play-overlay" class="play-overlay" aria-label="Play video">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <polygon points="5 3 19 12 5 21 5 3"></polygon>
      </svg>
    </button>

    <!-- Video overlay controls -->
    <div class="video-overlay">
      <div class="video-controls">
        <button type="button" id="play-toggle" class="control-button" aria-label="Play/Pause">
          <svg class="icon-play" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="5 3 19 12 5 21 5 3"></polygon>
          </svg>
          <svg class="icon-pause" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none;">
            <rect x="6" y="4" width="4" height="16"></rect>
            <rect x="14" y="4" width="4" height="16"></rect>
          </svg>
        </button>
        <button type="button" id="mute-toggle" class="control-button" aria-label="Mute/Unmute">
          <svg class="icon-sound" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
            <path d="M15.54 8.46a6.5 6.5 0 0 1 0 9.07"></path>
          </svg>
          <svg class="icon-mute" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none;">
            <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
            <line x1="23" y1="9" x2="17" y2="15"></line>
            <line x1="17" y1="9" x2="23" y2="15"></line>
          </svg>
        </button>
        <div class="progress" aria-hidden="true">
          <span id="progress-fill"></span>
        </div>
        <button type="button" id="skip-link" class="skip-button" aria-label="Skip to site">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
          <span>SKIP</span>
        </button>
      </div>

      <p class="gate-note">
        Best experienced with headphones
      </p>
    </div>
  </section>

  <!-- REST OF SITE (HIDDEN UNTIL VIDEO ENDS) -->
  <div id="site-content" class="hidden">
    <div class="page">
      <header>
        <h1>You Are Not Alone</h1>
        <div class="meta">
          2025 Â· Short film Â· AI and design
        </div>
      </header>

      <section class="section" id="context">
        <h2>Project context</h2>
        <p>
          [Your text here about the assignment and what this piece is.]
        </p>
      </section>

      <section class="section" id="statement">
        <h2>Artist statement</h2>
        <p>
          [Your artist statement lives here.]
        </p>
      </section>

      <section class="section" id="process">
        <h2>Process and AI</h2>
        <p>
          [Notes on Pika, Suno, Premiere, what you rejected, etc.]
        </p>
      </section>

      <section class="section" id="research">
        <h2>Research context</h2>
        <p>
          [Short paragraph about your research question and AI and emotion.]
        </p>
      </section>

      <section class="section" id="credits">
        <h2>Credits</h2>
        <p class="credits">
          Concept, direction, edit: Jaeden Crow<br />
          Course: AI and Design, Eastern Washington University<br />
          Instructor: Travis Masingale<br />
          Tools: Pika, Suno, Premiere Pro, Adobe suite
        </p>
      </section>

      <div style="margin-top: 60px; padding-top: 30px; border-top: 1px solid rgba(255, 255, 255, 0.15);">
        <button type="button" id="replay-btn" class="replay-button">
          REPLAY VIDEO
        </button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const video = document.getElementById("film");
      const gate = document.getElementById("video-gate");
      const videoOverlay = document.querySelector(".video-overlay");
      const siteContent = document.getElementById("site-content");
      const skipLink = document.getElementById("skip-link");
      const playToggle = document.getElementById("play-toggle");
      const muteToggle = document.getElementById("mute-toggle");
      const progressFill = document.getElementById("progress-fill");
      const playOverlay = document.getElementById("play-overlay");
      
      let gateClosed = false;
      let controlsHideTimer = null;

      function hidePlayOverlay() {
        if (playOverlay) {
          playOverlay.classList.add("hidden");
        }
      }

      function showPlayOverlay() {
        if (playOverlay) {
          playOverlay.classList.remove("hidden");
        }
      }

      function showControls() {
        if (videoOverlay) {
          videoOverlay.classList.remove("hidden-controls");
        }
        clearTimeout(controlsHideTimer);
        
        if (video && !video.paused) {
          controlsHideTimer = setTimeout(() => {
            if (videoOverlay && !video.paused) {
              videoOverlay.classList.add("hidden-controls");
            }
          }, 3000);
        }
      }

      function openSite() {
        if (gateClosed) return;
        gateClosed = true;

        if (video) {
          video.pause();
          gate.classList.add("hidden");
        }

        if (siteContent) {
          siteContent.classList.remove("hidden");
        }

        localStorage.setItem("videoWatched", "true");
        window.scrollTo({ top: 0, behavior: "instant" });
      }

      // Always show the video gate on page load
      gate.classList.remove("hidden");
      siteContent.classList.add("hidden");
      gateClosed = false;

      // Show play overlay button initially
      showPlayOverlay();

      // Set up video event listeners
      if (video) {
        // Try to autoplay
        const playPromise = video.play();
        if (playPromise !== undefined) {
          playPromise
            .then(() => {
              // Video started playing, hide the overlay button
              hidePlayOverlay();
              showControls();
            })
            .catch(err => {
              // Autoplay failed, keep the play button visible
              console.log("Autoplay not allowed, user can click play button");
              showPlayOverlay();
            });
        }

        // Hide overlay when video starts playing
        video.addEventListener("play", () => {
          hidePlayOverlay();
          if (playToggle) {
            playToggle.querySelector('.icon-play').style.display = 'none';
            playToggle.querySelector('.icon-pause').style.display = 'block';
          }
          showControls();
        });

        video.addEventListener("ended", openSite);
        
        video.addEventListener("timeupdate", () => {
          if (!progressFill || !video.duration) return;
          const percent = (video.currentTime / video.duration) * 100;
          progressFill.style.width = `${percent}%`;
        });

        video.addEventListener("pause", () => {
          if (playToggle) {
            playToggle.querySelector('.icon-play').style.display = 'block';
            playToggle.querySelector('.icon-pause').style.display = 'none';
          }
          if (videoOverlay) {
            videoOverlay.classList.remove("hidden-controls");
            clearTimeout(controlsHideTimer);
          }
        });

        video.addEventListener("volumechange", () => {
          if (!muteToggle) return;
          muteToggle.querySelector('.icon-sound').style.display = video.muted ? 'none' : 'block';
          muteToggle.querySelector('.icon-mute').style.display = video.muted ? 'block' : 'none';
        });

        // Show controls on mouse move
        if (videoOverlay) {
          videoOverlay.addEventListener("mouseenter", showControls);
          gate.addEventListener("mousemove", showControls);
        }
      }

      // Play overlay button - always available
      if (playOverlay && video) {
        playOverlay.addEventListener("click", () => {
          video.play();
        });
      }

      if (skipLink) {
        skipLink.addEventListener("click", function (e) {
          e.preventDefault();
          if (video) {
            video.currentTime = video.duration || video.currentTime;
          }
          openSite();
        });
      }

      if (playToggle && video) {
        playToggle.addEventListener("click", () => {
          if (video.paused) {
            video.play();
          } else {
            video.pause();
          }
        });
      }

      if (muteToggle && video) {
        muteToggle.addEventListener("click", () => {
          video.muted = !video.muted;
          muteToggle.innerHTML = video.muted ? '<span class="control-icon">ðŸ”‡</span>' : '<span class="control-icon">ðŸ”Š</span>';
        });
      }

      // Replay button functionality
      const replayBtn = document.getElementById("replay-btn");
      if (replayBtn) {
        replayBtn.addEventListener("click", () => {
          gateClosed = false;
          siteContent.classList.add("hidden");
          gate.classList.remove("hidden");
          video.currentTime = 0;
          video.play();
          window.scrollTo({ top: 0, behavior: "smooth" });
        });
      }
    });
  </script>
</body>
</html>
